# 多视角麻将牌谱系统

## 项目概述

本系统是在单视角麻将牌谱系统基础上开发的多视角版本，支持完整四人麻将牌局状态记录，包含手切/摸切弃牌分析、副露信息、分数状态等。

## 功能特点

### 🎯 主视角设置
- 支持选择任意玩家作为主视角（东南西北）
- 自动计算相对位置布局（下右上左）
- 主视角玩家显示完整手牌，其他玩家手牌可选

### 🀄 弃牌河增强
- **手切标记**：`1m*`（红色显示）
- **摸切标记**：`1m`（绿色显示） 
- **立直宣言**：`1m!`（橙色显示）
- 按时间顺序记录所有弃牌

### 🎴 副露系统
- **吃牌**：`吃123m(东)` - 显示来源玩家
- **碰牌**：`碰555s(南)` - 显示来源玩家
- **明杠**：`明杠7777p(西)` - 显示来源玩家
- **暗杠**：`暗杠2222m` - 无来源显示

### 📊 场况管理
- 完整的场风局数设置
- 当前巡目和剩余牌数
- 立直棒和本场数
- 宝牌指示牌管理

## 文件结构

```
multi-view-system/
├── types.ts              # TypeScript类型定义
├── utils.ts              # 工具函数
├── multi-view-demo.html  # HTML测试页面
├── multi-view-app.js     # JavaScript主应用
└── README.md             # 项目文档
```

## 核心数据结构

### MultiViewGameState（多视角游戏状态）
```typescript
interface MultiViewGameState {
  mainViewPlayer: PlayerPosition;    // 主视角玩家
  windRound: WindRound;             // 场风
  roundNumber: number;              // 局数
  players: {                        // 四个玩家状态
    [PlayerPosition.EAST]: PlayerState;
    [PlayerPosition.SOUTH]: PlayerState;
    [PlayerPosition.WEST]: PlayerState;
    [PlayerPosition.NORTH]: PlayerState;
  };
  remainingTiles: number;           // 剩余牌数
  doraIndicators: string[];         // 宝牌指示牌
  currentTurn: PlayerPosition;      // 当前轮到的玩家
  turnCount: number;                // 当前巡目
}
```

### PlayerState（玩家状态）
```typescript
interface PlayerState {
  position: PlayerPosition;           // 玩家位置
  handTiles: string[];               // 手牌
  melds: Meld[];                     // 副露区
  discardedTiles: DiscardedTile[];   // 弃牌河
  score: number;                     // 当前分数
  isRiichi: boolean;                 // 是否立直
}
```

### DiscardedTile（弃牌信息）
```typescript
interface DiscardedTile {
  tile: string;                      // 弃牌
  type: DiscardType;                 // 手切/摸切
  isRiichi?: boolean;                // 是否立直宣言牌
  order: number;                     // 弃牌顺序
}
```

## 验证规则

### 手牌验证
- **主视角玩家**：必须输入手牌，总数必须为13或14张
- **其他玩家**：手牌可选，但如输入也需符合13/14张规则
- **副露计算**：手牌数 + 副露牌数 = 13或14张

### 格式验证
- **牌格式**：`1m 2p 3s 1z`（万筒条字）
- **副露格式**：`吃123m(东) 碰555s(南)`
- **弃牌格式**：`1m 2p* 3s 4z!`（*手切 !立直）

## 界面布局

### 牌桌预览
```
    [ 上方玩家 ]
[左方] [中央信息] [右方]
    [ 下方玩家 ]
```

- **下方**：主视角玩家（绿色高亮）
- **右方**：顺时针下一家
- **上方**：对家
- **左方**：逆时针下一家

### 标签页结构
1. **🎯 场况设置** - 基本信息和场况配置
2. **📝 牌局输入** - 四个玩家详细信息输入
3. **👁️ 牌桌预览** - 实时预览牌桌状态
4. **📚 牌谱浏览** - 管理已保存的牌谱
5. **📖 格式说明** - 详细的使用说明

## 使用方法

### 基本流程
1. **场况设置**：选择主视角玩家、场风、局数等
2. **牌局输入**：输入各玩家手牌、副露、弃牌河
3. **预览确认**：查看牌桌布局和信息
4. **保存牌谱**：上传到本地存储

### 示例数据
系统提供完整的示例数据，展示：
- 南家主视角听牌场景
- 包含副露的复杂局面
- 手切摸切弃牌分析
- 北家立直状态

## 技术特点

### 模块化设计
- 独立的文件夹结构，不影响单视角系统
- 可复用的类型定义和工具函数
- 清晰的关注点分离

### 实时验证
- 即时手牌数量验证
- 副露格式检查
- 整体状态验证

### 响应式布局
- 适配不同屏幕尺寸
- 移动端友好的折叠布局
- 直观的视觉反馈

## 与单视角系统的区别

| 特性 | 单视角 | 多视角 |
|------|--------|--------|
| 玩家数据 | 1个玩家完整信息 | 4个玩家完整信息 |
| 手牌显示 | 主视角完整 | 主视角必填，其他可选 |
| 弃牌河 | 单一弃牌河 | 四个弃牌河 + 手切摸切 |
| 场况信息 | 简化场况 | 完整场况（场风、巡目等） |
| 适用场景 | 单纯技巧分析 | 完整对局分析、读牌教学 |

## 开发计划

### 已完成 ✅
- [x] 基础数据结构设计
- [x] HTML界面框架
- [x] 相对位置计算
- [x] 基础JavaScript应用框架

### 开发中 🚧
- [ ] 完整的解析函数实现
- [ ] 牌桌预览功能
- [ ] 本地存储功能
- [ ] 示例数据加载

### 计划功能 📋
- [ ] 牌谱回放功能
- [ ] 导入导出功能
- [ ] 与单视角系统集成
- [ ] 进阶分析工具

## 部署说明

### 独立运行
```bash
# 直接打开HTML文件
open multi-view-demo.html
```

### 本地服务器
```bash
# 启动本地服务器
python -m http.server 8000
# 访问 http://localhost:8000/multi-view-demo.html
```

## 注意事项

1. **数据独立性**：多视角牌谱与单视角牌谱分别存储
2. **格式兼容性**：保持与单视角系统相同的牌和副露格式
3. **性能考虑**：四个玩家的数据处理需要优化
4. **用户体验**：复杂界面需要清晰的引导和反馈

## 贡献指南

1. 遵循现有的代码风格和命名规范
2. 保持与单视角系统的一致性
3. 充分测试验证逻辑
4. 更新相关文档

---

**项目状态**：开发中 🚧  
**最后更新**：2024年6月11日  
**下一步计划**：完善JavaScript应用功能 